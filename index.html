<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Professional Meta Tags for SEO -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- FIX 1: Shorter Title Tag (Optimized for 50-60 chars) -->
    <title>The RAILSPK - Pakistan Railways Hub | Reviews & Vlogs</title>
    
    <meta name="description" content="Discover Pakistan Railways. User-driven train ratings, high-res wallpapers, community polls, official fares, and travel vlogs.">
    <meta name="keywords" content="Pakistan Railways Ratings, Train Wallpapers, Railway Polls, Green Line Fares, Railspk, Shalimar Express Reviews, Travel Vlogs Pakistan, Railway Community, Trainspotting, Pakistan Train Reviews">
    <meta name="author" content="The RAILSPK Team">

    <!-- FIX 2: Canonical Tag -->
    <link rel="canonical" href="https://therails.pk/" />

    <!-- Open Graph Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://therails.pk/">
    <meta property="og:title" content="The RAILSPK - Pakistan Railways Hub">
    <meta property="og:description" content="Official digital portal for Pakistan Railways vlogs, user ratings, and community updates.">
    <meta property="og:image" content="https://therails.pk/images/train_background.jpg">

    <!-- FIX 3: Structured Data (JSON-LD Schema) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "The RAILSPK",
      "url": "https://therails.pk/",
      "description": "Digital portal for Pakistan Railways vlogs, reviews, and community updates.",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://therails.pk/reviews?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>

    <!-- Preconnect -->
    <link rel="preconnect" href="https://www.googleapis.com">
    <link rel="preconnect" href="https://www.gstatic.com">

    <!-- Adsense script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8566339481152239" crossorigin="anonymous"></script>

    <!-- Google Analytics -->
    <script>
        window.addEventListener('load', () => {
            const gtScript = document.createElement('script');
            gtScript.async = true;
            gtScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-QL2CKH2MBL';
            document.head.appendChild(gtScript);
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-QL2CKH2MBL');
        });
    </script>

    <link rel="icon" href="images/favicon.ico" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        .dark ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }
        html { scroll-behavior: smooth; transition: background-color 0.3s ease; }
        .stars { color: #f59e0b; }
        .hero-slide { opacity: 0; transition: opacity 1.5s ease-in-out; position: absolute; inset: 0; }
        .hero-slide.active { opacity: 1; }
        .slide { transition: opacity 0.4s ease-in-out; position: absolute; inset: 0; }
        .slide.hidden { display: none; }
        .page-view { display: none; }
        .page-view.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .poll-bar { transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
        .social-link { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .social-link:hover { transform: translateY(-5px); }
        .fb-hover:hover { color: #1877F2 !important; }
        .yt-hover:hover { color: #FF0000 !important; }
        .ig-hover:hover { color: #E4405F !important; }
        .wa-hover:hover { color: #25D366 !important; }
        body { transition: background-color 0.3s, color 0.3s; }
        .line-clamp-4 { display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
        #upload-spinner { border-top-color: #4f46e5; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .ad-container { display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; margin: 2rem auto; text-align: center; }
        .ad-label { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; color: #9ca3af; margin-bottom: 8px; }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { 'rail-dark': '#111827', 'rail-accent': '#4f46e5' } } }
        }
    </script>
</head>
<body class="bg-white text-gray-900 dark:bg-rail-dark dark:text-gray-200 font-sans antialiased overflow-x-hidden transition-colors duration-300">

    <!-- Header Navigation -->
    <header class="sticky top-0 z-50 bg-white/80 dark:bg-rail-dark/95 backdrop-blur-md shadow-lg border-b border-gray-200 dark:border-white/5">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16 md:h-20 text-gray-900 dark:text-white">
            <a href="/home" onclick="routeTo(event, '/home')" class="text-xl md:text-3xl font-extrabold text-gray-900 dark:text-white font-heading">
                The <span class="text-rail-accent">RAILSPK</span>
            </a>
            <div class="flex items-center space-x-2 md:space-x-8">
                <nav class="hidden lg:flex space-x-8 text-sm uppercase tracking-widest font-bold">
                    <a href="/home" onclick="routeTo(event, '/home')" class="nav-link hover:text-rail-accent transition">Home</a>
                    <a href="/gallery" onclick="routeTo(event, '/gallery')" class="nav-link hover:text-rail-accent transition">Gallery</a>
                    <a href="/reviews" onclick="routeTo(event, '/reviews')" class="nav-link hover:text-rail-accent transition">Reviews</a> 
                    <a href="/community" onclick="routeTo(event, '/community')" class="nav-link hover:text-rail-accent transition">Community</a>
                    <a href="/about" onclick="routeTo(event, '/about')" class="nav-link hover:text-rail-accent transition">About</a>
                </nav>
                <div class="flex items-center space-x-2 md:space-x-4 border-l border-gray-200 dark:border-gray-700 pl-3 md:pl-8 text-gray-900 dark:text-white text-gray-900 dark:text-white">
                    <!-- FIX 1: Admin button always visible -->
                    <button id="admin-trigger" class="inline-flex items-center px-4 md:px-5 py-2 bg-rail-accent/10 dark:bg-rail-accent/20 text-rail-accent rounded-full text-[10px] font-black uppercase tracking-widest hover:bg-rail-accent hover:text-white transition-all shadow-sm">Admin</button>
                    
                    <!-- FIX 2: Dark mode button alignment -->
                    <button id="theme-toggle" class="w-10 h-10 flex items-center justify-center rounded-xl bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-200 hover:bg-rail-accent/10 focus:outline-none transition-all shadow-sm border border-gray-200 dark:border-gray-700">
                        <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                        <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"></path></svg>
                    </button>
                    <button class="lg:hidden p-2 text-gray-500 dark:text-gray-200" onclick="toggleMenu()">
                        <svg class="w-6 h-6 md:w-7 md:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16m-7 6h7" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden lg:hidden bg-white dark:bg-rail-dark border-b border-gray-200 dark:border-gray-700 shadow-2xl p-6 space-y-4 absolute w-full z-[60]">
            <a href="/home" class="block font-black text-lg uppercase" onclick="routeTo(event, '/home'); toggleMenu();">Home</a>
            <a href="/gallery" class="block font-black text-lg uppercase" onclick="routeTo(event, '/gallery'); toggleMenu();">Gallery</a>
            <a href="/reviews" class="block font-black text-lg uppercase" onclick="routeTo(event, '/reviews'); toggleMenu();">Reviews</a>
            <a href="/community" class="block font-black text-lg uppercase" onclick="routeTo(event, '/community'); toggleMenu();">Community</a>
            <a href="/about" class="block font-black text-lg uppercase" onclick="routeTo(event, '/about'); toggleMenu();">About</a>
            <button onclick="checkAdmin(); toggleMenu();" class="w-full py-3 bg-rail-accent text-white rounded-xl font-black uppercase tracking-widest shadow-lg">Admin Access</button>
        </div>
    </header>

    <main>
        <!-- 1. HOME VIEW -->
        <section id="home-view" class="page-view">
            <!-- TOP AD -->
            <div class="ad-container max-w-screen-2xl">
                <span class="ad-label">Advertisement</span>
                <script>
                  atOptions = { 'key' : '10a9cef115b81397cdb16c2beb565239', 'format' : 'iframe', 'height' : 90, 'width' : 728, 'params' : {} };
                </script>
                <script src="https://crazylatchdisturbance.com/10a9cef115b81397cdb16c2beb565239/invoke.js"></script>
            </div>

            <div class="relative h-[60vh] md:h-[80vh] w-full overflow-hidden bg-rail-dark text-white">
                <div id="hero-slideshow" class="absolute inset-0">
                    <!-- FIX 4: Image Alt Tags for background -->
                    <div class="hero-slide active bg-cover bg-center" style="background-image: url('images/train_background.jpg');" role="img" aria-label="Pakistan Railways Green Line Express at Dawn">
                        <div class="absolute inset-0 bg-black/60"></div>
                    </div>
                    <div class="hero-slide bg-cover bg-center" style="background-image: url('images/train_background2.jpeg');" role="img" aria-label="Cinematic Railway Track Landscape">
                        <div class="absolute inset-0 bg-black/60"></div>
                    </div>
                </div>
                <div class="relative z-10 h-full flex flex-col items-center justify-center text-center px-6 text-gray-900 dark:text-white text-gray-900 dark:text-white">
                    <h1 class="text-4xl sm:text-6xl md:text-9xl font-black mb-4 md:mb-6 font-heading tracking-tighter uppercase italic drop-shadow-2xl">The <span class="text-rail-accent">RAILSPK</span></h1>
                    <p class="text-base md:text-3xl mb-8 md:mb-10 max-w-4xl font-light text-gray-200 text-shadow-lg text-gray-100">Official digital portal for Pakistan Railways vlogs, reviews, and updates.</p>
                    <div class="flex flex-col sm:flex-row gap-4 md:gap-6 w-full sm:w-auto text-gray-900 dark:text-white text-gray-900 dark:text-white">
                        <a href="/reviews" onclick="routeTo(event, '/reviews')" class="bg-rail-accent hover:bg-rail-accent/80 text-white px-8 md:px-12 py-4 md:py-5 rounded-xl md:rounded-2xl font-black transition shadow-2xl hover:scale-105 transform text-center text-shadow-lg">View Reviews</a>
                        <a href="/community" onclick="routeTo(event, '/community')" class="bg-white/10 backdrop-blur-md border border-white/20 text-white px-8 md:px-12 py-4 md:py-5 rounded-xl md:rounded-2xl font-black hover:bg-white/20 transition text-center text-shadow-lg">Join Community</a>
                    </div>
                </div>
            </div>

            <div class="max-w-screen-2xl mx-auto px-4 md:px-6 py-12 md:py-24 text-gray-900 dark:text-white text-gray-900 dark:text-white">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-10 md:mb-16 gap-6 md:gap-8">
                    <div>
                        <h2 class="text-3xl md:text-5xl font-black mb-2 md:mb-4 uppercase italic">Latest <span class="text-rail-accent">Journeys</span></h2>
                        <p class="text-gray-500 dark:text-gray-400 font-medium font-sans text-sm md:text-base">Fresh content from our official YouTube channel.</p>
                    </div>
                    <select id="video-filter" class="w-full md:w-auto bg-gray-100 dark:bg-gray-800 border-none rounded-xl md:rounded-2xl p-4 md:p-5 outline-none ring-1 ring-gray-200 dark:ring-gray-700 font-bold text-gray-900 dark:text-white text-gray-900 dark:text-white">
                        <option value="long">Long Vlogs</option>
                        <option value="medium">Medium Content</option>
                        <option value="short">Short Clips</option>
                    </select>
                </div>
                <div id="video-cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-12"></div>
                <div class="ad-container max-w-4xl">
                    <span class="ad-label">Sponsored Content</span>
                    <script async="async" data-cfasync="false" src="https://crazylatchdisturbance.com/135d9080577862d37eb360cfd6b790f5/invoke.js"></script>
                    <div id="container-135d9080577862d37eb360cfd6b790f5"></div>
                </div>
                <div class="mt-12 md:mt-16 text-center px-4">
                    <button id="load-more-btn" class="w-full md:w-auto bg-rail-accent text-white px-10 md:px-14 py-4 md:py-5 rounded-xl md:rounded-2xl font-black shadow-xl hover:scale-105 transition transform uppercase tracking-widest text-gray-900 dark:text-white">Load More Vlogs</button>
                </div>
            </div>
        </section>

        <!-- 2. GALLERY VIEW -->
        <section id="gallery-view" class="page-view">
            <div class="max-w-screen-2xl mx-auto px-4 md:px-6 py-12 md:py-20 text-gray-900 dark:text-white">
                <h2 class="text-3xl md:text-6xl font-black text-center mb-4 md:mb-6 font-heading tracking-tight underline decoration-rail-accent decoration-4 md:decoration-8 underline-offset-4 md:underline-offset-8 uppercase italic">Railway Gallery</h2>
                <p class="text-center text-gray-500 dark:text-gray-400 mb-10 md:mb-20 text-sm md:text-xl font-medium tracking-widest uppercase font-sans">High-Resolution Train Wallpapers</p>
                <div id="gallery-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </div>
        </section>

        <!-- 3. REVIEWS VIEW -->
        <section id="reviews-view" class="page-view">
            <div class="max-w-screen-2xl mx-auto px-4 md:px-6 py-12 md:py-20 text-gray-900 dark:text-white">
                <h2 class="text-3xl md:text-6xl font-black text-center mb-4 md:mb-6 font-heading tracking-tight underline decoration-rail-accent decoration-4 md:decoration-8 underline-offset-4 md:underline-offset-8 uppercase italic">Train Scorecards</h2>
                <p class="text-center text-gray-500 dark:text-gray-400 mb-10 md:mb-20 text-sm md:text-xl font-medium tracking-widest uppercase font-sans">Live Public Ratings & Performance Metrics</p>
                <div id="scorecards-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 text-gray-900 dark:text-white"></div>
            </div>
        </section>

        <!-- 4. COMMUNITY VIEW -->
        <section id="community-view" class="page-view">
            <div class="max-w-screen-xl mx-auto px-4 md:px-6 py-12 md:py-20 text-gray-900 dark:text-white">
                <div class="flex justify-between items-center mb-10 md:mb-16 pb-6 md:pb-8 border-b border-gray-100 dark:border-gray-800">
                    <h2 class="text-3xl md:text-6xl font-black font-heading tracking-tighter italic uppercase text-gray-900 dark:text-white text-gray-900 dark:text-white">Official <span class="text-rail-accent">Broadcasts</span></h2>
                    <span class="hidden sm:block text-xs font-black uppercase tracking-widest text-gray-400">Live Cloud Feed</span>
                </div>
                <div id="polls-container" class="mb-12 space-y-6"></div>
                <div id="admin-panel" class="hidden mb-12 md:mb-16 bg-rail-accent/5 border-2 md:border-4 border-dashed border-rail-accent p-6 md:p-12 rounded-3xl animate-fade-in text-gray-900 dark:text-white text-gray-900 dark:text-white">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div>
                            <h3 class="text-xl md:text-3xl font-black mb-6 text-rail-accent uppercase italic font-heading">New Announcement</h3>
                            <form id="update-form" class="space-y-4">
                                <input type="text" id="update-title" placeholder="Headline" required class="w-full bg-white dark:bg-gray-800 p-4 rounded-2xl md:rounded-3xl shadow-sm text-lg outline-none ring-1 ring-gray-200 dark:ring-gray-700">
                                <input type="file" id="update-image-file" accept="image/*" class="w-full bg-white dark:bg-gray-800 p-3 md:p-4 rounded-2xl shadow-sm text-sm">
                                <textarea id="update-content" placeholder="Type details..." required class="w-full bg-white dark:bg-gray-800 p-4 md:p-6 rounded-2xl h-32 shadow-sm text-gray-900 dark:text-white"></textarea>
                                <button type="submit" id="update-btn" class="w-full bg-rail-accent text-white px-10 md:px-14 py-4 md:py-5 rounded-xl md:rounded-2xl font-black shadow-2xl hover:scale-105 transition transform flex items-center justify-center gap-3">
                                    <span id="btn-text">PUBLISH BROADCAST</span>
                                </button>
                            </form>
                        </div>
                        <div>
                            <h3 class="text-xl md:text-3xl font-black mb-6 text-rail-accent uppercase italic font-heading text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white">Create New Poll</h3>
                            <form id="poll-form" class="space-y-4">
                                <input type="text" id="poll-question" placeholder="Poll Question?" required class="w-full bg-white dark:bg-gray-800 p-4 rounded-2xl md:rounded-3xl shadow-sm text-lg outline-none ring-1 ring-gray-200 dark:ring-gray-700">
                                <input type="text" id="poll-options" placeholder="Option 1, Option 2, Option 3" required class="w-full bg-white dark:bg-gray-800 p-4 rounded-2xl md:rounded-3xl shadow-sm text-lg outline-none ring-1 ring-gray-200 dark:ring-gray-700">
                                <button type="submit" class="w-full bg-gray-900 text-white dark:bg-white dark:text-gray-900 px-10 py-4 md:py-5 rounded-xl md:rounded-2xl font-black shadow-2xl text-gray-900 dark:text-white">CREATE POLL</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div id="updates-container" class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-10 text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white">
                    <p id="updates-status" class="text-center py-20 col-span-full text-gray-400 font-black tracking-widest animate-pulse uppercase">CONNECTING TO RAILWAY CLOUD...</p>
                </div>
            </div>
        </section>

        <!-- 5. ABOUT VIEW -->
        <section id="about-view" class="page-view">
            <div class="max-w-screen-xl mx-auto px-6 py-12 md:py-32 text-center text-gray-900 dark:text-white">
                <span class="text-rail-accent font-black tracking-[0.2em] md:tracking-[0.3em] uppercase mb-4 md:mb-6 block font-sans text-sm md:text-base">The Hub Mission</span>
                <h2 class="text-4xl md:text-7xl lg:text-9xl font-black mb-8 md:mb-12 tracking-tighter uppercase italic text-gray-900 dark:text-white">RAILSPK HUB</h2>
                <p class="text-lg md:text-3xl text-gray-500 dark:text-gray-400 leading-relaxed max-w-5xl mx-auto mb-16 md:mb-24 font-light text-gray-900 dark:text-white">
                    RAILSPK is a digital archive for Pakistan Railways. Documenting the evolution of the national carrier through cinematics and authentic reviews.
                </p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-10 text-gray-900 dark:text-white">
                    <div class="bg-gray-50 dark:bg-gray-800/50 p-8 md:p-12 rounded-3xl md:rounded-[3.5rem] border border-gray-100 dark:border-gray-700 shadow-xl"><span id="stat-subs" class="text-3xl md:text-5xl font-black text-rail-accent block mb-2 italic tracking-tighter">10K+</span><span class="text-[10px] md:text-xs font-black text-gray-500 uppercase tracking-widest text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white">Subscribers</span></div>
                    <div class="bg-gray-50 dark:bg-gray-800/50 p-8 md:p-12 rounded-3xl md:rounded-[3.5rem] border border-gray-100 dark:border-gray-700 shadow-xl"><span id="stat-views" class="text-3xl md:text-5xl font-black text-rail-accent block mb-2 italic tracking-tighter">500K+</span><span class="text-[10px] md:text-xs font-black text-gray-500 uppercase font-bold text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white">Total Views</span></div>
                    <div class="bg-gray-50 dark:bg-gray-800/50 p-8 md:p-12 rounded-3xl md:rounded-[3.5rem] border border-gray-100 dark:border-gray-700 shadow-xl"><span id="stat-videos" class="text-3xl md:text-5xl font-black text-rail-accent block mb-2 italic tracking-tighter">150+</span><span class="text-[10px] md:text-xs font-black text-gray-500 uppercase font-bold font-sans text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white">Travel Vlogs</span></div>
                    <div class="bg-gray-50 dark:bg-gray-800/50 p-8 md:p-12 rounded-3xl md:rounded-[3.5rem] border border-gray-100 dark:border-gray-700 shadow-xl text-gray-900 dark:text-white"><span class="text-3xl md:text-5xl font-black text-rail-accent block italic tracking-tighter text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white">17</span><span class="text-[10px] md:text-xs font-black text-gray-500 uppercase font-bold font-sans text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white">Train Scores</span></div>
                </div>
            </div>
        </section>

        <!-- 5. TERMS VIEW (Professional Content Refilled) -->
        <section id="terms-view" class="page-view">
            <div class="max-w-4xl mx-auto px-6 py-12 md:py-24 text-gray-900 dark:text-white">
                <h2 class="text-3xl md:text-5xl font-black mb-8 uppercase italic text-rail-accent">Terms of Service</h2>
                <div class="space-y-8 text-gray-600 dark:text-gray-300 font-sans leading-relaxed text-sm md:text-lg">
                    <p>Welcome to **The RAILSPK Hub**. By accessing and using this website, you agree to comply with and be bound by the following terms and conditions of use.</p>
                    
                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">1. Intellectual Property</h3>
                        <p>All content published on this platform, including but not limited to travel vlogs, train scorecards, class fare data, and community broadcasts, is the intellectual property of RAILSPK. Unauthorized redistribution, commercial use, or modification of any media without explicit written consent is strictly prohibited.</p>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">2. User-Generated Content</h3>
                        <p>Users are solely responsible for the content they post in the review and feedback sections. RAILSPK reserves the right to monitor, edit, or remove any content that is deemed offensive, promotional, or inaccurate to maintain community standards.</p>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">3. Data Accuracy Disclaimer</h3>
                        <p>While we strive to provide the most current fares and class formations sourced from official entities like Pakistan Railways and private operators (AA Enterprises), RAILSPK does not guarantee the absolute accuracy of this data at all times due to sudden operational changes by the railway authorities.</p>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">4. External Links</h3>
                        <p>Our website may contain links to third-party sites such as YouTube and official government portals. RAILSPK has no control over the content or availability of these external sites and is not liable for any issues arising from their use.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. PRIVACY VIEW (Professional Content Refilled) -->
        <section id="privacy-view" class="page-view">
            <div class="max-w-4xl mx-auto px-6 py-12 md:py-24 text-gray-900 dark:text-white">
                <h2 class="text-3xl md:text-5xl font-black mb-8 uppercase italic text-rail-accent">Privacy Policy</h2>
                <div class="space-y-8 text-gray-600 dark:text-gray-300 font-sans leading-relaxed text-sm md:text-lg">
                    <p>At **The RAILSPK Hub**, we are committed to protecting the privacy and security of our visitors. This policy explains how we collect and use your data.</p>

                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">1. Information Collection</h3>
                        <p>We only collect information that you voluntarily provide to us, such as your name and feedback when submitting a train review or reacting to a broadcast. We do not require account registration or sensitive personal data for regular browsing.</p>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">2. Use of Cookies & Analytics</h3>
                        <p>We utilize industry-standard tools like **Google Analytics** and **Google AdSense**. These services use cookies to analyze anonymous traffic patterns and to serve relevant advertisements based on your interests. This data helps us improve site performance and user experience.</p>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">3. Data Sharing</h3>
                        <p>Your voluntarily shared feedback (reviews) is public and intended to help the railway community. However, your private data is never sold, traded, or shared with third-party marketing companies.</p>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">4. Data Security</h3>
                        <p>We implement various security measures to maintain the safety of the data stored in our cloud database. While no method of transmission over the internet is 100% secure, we follow best practices to protect your information.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- BOTTOM AD (4:1 Large Banner) -->
    <div class="ad-container max-w-screen-2xl">
        <span class="ad-label">Advertisement</span>
        <script async="async" data-cfasync="false" src="https://crazylatchdisturbance.com/135d9080577862d37eb360cfd6b790f5/invoke.js"></script>
        <div id="container-135d9080577862d37eb360cfd6b790f5"></div>
    </div>

    <!-- Footer -->
    <footer class="py-12 md:py-24 text-center border-t border-gray-100 dark:border-gray-800 text-gray-900 dark:text-white px-6">
        <div class="flex justify-center space-x-6 md:space-x-10 mb-8 md:mb-12">
            <!-- FIX 5: Added rel="nofollow" for external links as per SEO report -->
            <a href="https://facebook.com/therailspk" rel="nofollow" target="_blank" class="social-link fb-hover text-3xl md:text-4xl text-gray-400 text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white"><i class="fab fa-facebook"></i></a>
            <a href="https://youtube.com/@therailspk" rel="nofollow" target="_blank" class="social-link yt-hover text-3xl md:text-4xl text-gray-400 text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white"><i class="fab fa-youtube"></i></a>
            <a href="https://instagram.com/therailspk" rel="nofollow" target="_blank" class="social-link ig-hover text-3xl md:text-4xl text-gray-400 text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white"><i class="fab fa-instagram"></i></a>
            <a href="https://whatsapp.com/channel/0029VbBHeff8PgsJZYRHwv3O" rel="nofollow" target="_blank" class="social-link wa-hover text-3xl md:text-4xl text-gray-400 text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white"><i class="fab fa-whatsapp"></i></a>
        </div>
        <p class="text-gray-400 text-[10px] md:text-[11px] tracking-[0.4em] uppercase font-black mb-4 italic font-sans">© 2025 The RAILSPK | Digital Legacy Project</p>
        <div class="flex justify-center space-x-6 text-[10px] font-bold uppercase tracking-widest text-gray-500">
            <a href="/privacy" onclick="routeTo(event, '/privacy')" class="hover:text-rail-accent transition text-gray-900 dark:text-white text-gray-900 dark:text-white">Privacy Policy</a>
            <a href="/terms" onclick="routeTo(event, '/terms')" class="hover:text-rail-accent transition text-gray-900 dark:text-white text-gray-900 dark:text-white">Terms of Service</a>
        </div>
    </footer>

    <!-- Logic Script -->
    <script>
        let db, auth, user, adminAuthorised = false;
        let YT_KEY = "AIzaSyAax2bSR8u33U5DKCSt8ffEmEyGHbnquWU", YT_CHANNEL = "UC0jiPBcE-2QbiBLt2m3MHSQ";
        let yt_token = null, yt_duration = 'long', allReviews = [];

        const currentAppId = 'railspk-official-1de54'.replace(/[^a-zA-Z0-9_-]/g, '_'); 
        const fbConfigUser = { apiKey: "AIzaSyCfoXeQk-6ubcJZz3ES7c6yE2IWSFp2z9A", authDomain: "railspk-official-1de54.firebaseapp.com", projectId: "railspk-official-1de54", storageBucket: "railspk-official-1de54.firebasestorage.app", messagingSenderId: "282037027182", appId: "1:282037027182:web:6b4f8bb420eb410374c17f" };

        const trainsData = [
            { id: 'khybermail', name: 'Khyber Mail Express', route: 'Karachi ⟷ Peshawar', slides: ['coming_soon.avif'], fares: [{class:"AC Sleeper",price:"Rs. 13,000"},{class:"AC Business",price:"Rs. 9,500"},{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 4,000"}], avgRating: 0, reviewCount: 0 },
            { id: 'greenline', name: 'Green Line Express', route: 'Karachi ⟷ Islamabad', slides: ['greenline_1.webp','greenline_8.webp'], fares: [{class:"AC Parlor",price:"Rs. 13,500"},{class:"AC Business",price:"Rs. 11,500"},{class:"AC Standard",price:"Rs. 9,000"},{class:"Economy",price:"Rs. 4,500"}], avgRating: 0, reviewCount: 0 },
            { id: 'tezgam', name: 'Tezgam Express', route: 'Karachi ⟷ Rawalpindi', slides: ['coming_soon.avif'], fares: [{class:"AC Sleeper",price:"Rs. 12,000"},{class:"AC Business",price:"Rs. 9,000"},{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,800"}], avgRating: 0, reviewCount: 0 },
            { id: 'allamaiqbal', name: 'Allama Iqbal Express', route: 'Karachi ⟷ Sialkot', slides: ['allama_iqbal_1.jpeg','allama_iqbal_2.jpeg'], fares: [{class:"AC Standard",price:"Rs. 6,800"},{class:"Economy",price:"Rs. 3,500"}], avgRating: 0, reviewCount: 0 },
            { id: 'hazara', name: 'Hazara Express', route: 'Karachi ⟷ Havelian', slides: ['coming_soon.avif'], fares: [{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,600"}], avgRating: 0, reviewCount: 0 },
            { id: 'awam', name: 'Awam Express', route: 'Karachi ⟷ Peshawar', slides: ['coming_soon.avif'], fares: [{class:"AC Business",price:"Rs. 9,500"},{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 3,800"}], avgRating: 0, reviewCount: 0 },
            { id: 'karachi', name: 'Karachi Express', route: 'Karachi ⟷ Lahore', slides: ['coming_soon.avif'], fares: [{class:"AC Sleeper",price:"Rs. 11,500"},{class:"AC Business",price:"Rs. 9,500"},{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 3,800"}], avgRating: 0, reviewCount: 0 },
            { id: 'millat', name: 'Millat Express', route: 'Karachi ⟷ Faisalabad', slides: ['coming_soon.avif'], fares: [{class:"AC Business",price:"Rs. 9,000"},{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,500"}], avgRating: 0, reviewCount: 0 },
            { id: 'shalimar', name: 'Shalimar Express', route: 'Karachi ⟷ Lahore', slides: ['shalimar_1.jpg','shalimar_8.jpg'], fares: [{class:"AC Parlor",price:"Rs. 11,000"},{class:"AC Business",price:"Rs. 9,000"},{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,500"}], avgRating: 0, reviewCount: 0 },
            { id: 'pakbusiness', name: 'Pak Business Express', route: 'Karachi ⟷ Lahore', slides: ['business_1.webp','business_8.webp'], fares: [{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 3,800"}], avgRating: 0, reviewCount: 0 },
            { id: 'fareed', name: 'Fareed Express', route: 'Karachi ⟷ Lahore (PKP)', slides: ['coming_soon.avif'], fares: [{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,500"}], avgRating: 0, reviewCount: 0 },
            { id: 'karakoram', name: 'Karakoram Express', route: 'Karachi ⟷ Lahore', slides: ['coming_soon.avif'], fares: [{class:"AC Business",price:"Rs. 9,500"},{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 4,000"}], avgRating: 0, reviewCount: 0 },
            { id: 'pakistanexp', name: 'Pakistan Express', route: 'Karachi ⟷ Rawalpindi', slides: ['coming_soon.avif'], fares: [{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,600"}], avgRating: 0, reviewCount: 0 },
            { id: 'rehmanbaba', name: 'Rehman Baba Express', route: 'Karachi ⟷ Peshawar', slides: ['coming_soon.avif'], fares: [{class:"AC Business",price:"Rs. 10,000"},{class:"AC Standard",price:"Rs. 8,000"},{class:"Economy",price:"Rs. 4,200"}], avgRating: 0, reviewCount: 0 },
            { id: 'sukkur', name: 'Sukkur Express', route: 'Karachi ⟷ Sukkur', slides: ['coming_soon.avif'], fares: [{class:"AC Sleeper",price:"Rs. 7,000"},{class:"AC Business",price:"Rs. 5,000"},{class:"AC Standard",price:"Rs. 4,000"},{class:"Economy",price:"Rs. 2,200"}], avgRating: 0, reviewCount: 0 },
            { id: 'mehran', name: 'Mehran Express', route: 'Karachi ⟷ Mirpur Khas', slides: ['coming_soon.avif'], fares: [{class:"Economy",price:"Rs. 800"}], avgRating: 0, reviewCount: 0 },
            { id: 'shahlatif', name: 'Shah Latif Express', route: 'Karachi ⟷ Mirpur Khas', slides: ['coming_soon.avif'], fares: [{class:"Economy",price:"Rs. 800"}], avgRating: 0, reviewCount: 0 }
        ];

        const galleryData = [
            { title: "Green Line Dawn", src: "images/train_background.jpg" },
            { title: "Railway Track Symmetry", src: "images/train_background2.jpeg" },
            { title: "Allama Iqbal Arrival", src: "images/allama_iqbal_1.jpeg" },
            { title: "Departure Sunset", src: "images/allama_iqbal_2.jpeg" }
        ];

        async function initFirebase() {
            try {
                let cfg = fbConfigUser;
                if (typeof __firebase_config !== 'undefined' && __firebase_config) cfg = (typeof __firebase_config === 'string') ? JSON.parse(__firebase_config) : __firebase_config;
                if (!firebase.apps.length) firebase.initializeApp(cfg);
                db = firebase.firestore(); auth = firebase.auth();
                auth.onAuthStateChanged(async (u) => {
                    user = u; if (user) { await fetchYoutubeConfig(); startReviewsListener(); startPollsListener(); fetchUpdates(); handleRouting(); }
                });
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) await auth.signInWithCustomToken(__initial_auth_token).catch(() => auth.signInAnonymously());
                else await auth.signInAnonymously();
            } catch (e) { }
        }

        async function fetchYoutubeConfig() {
            try { if (!user) return; const doc = await db.collection('artifacts').doc(currentAppId).collection('public').doc('data').collection('config').doc('youtube').get(); if (doc.exists) { YT_KEY = doc.data().key; YT_CHANNEL = doc.data().channelId; } } catch (e) {}
        }

        function renderGallery() {
            const grid = document.getElementById('gallery-grid'); if (!grid) return;
            grid.innerHTML = galleryData.map(img => `
                <div class="group relative overflow-hidden rounded-[2.5rem] bg-gray-100 dark:bg-gray-800 shadow-xl border border-gray-100 dark:border-gray-700">
                    <!-- FIX 6: Added Alt Tag for gallery images -->
                    <img src="${img.src}" alt="${img.title} - Pakistan Railways High-Res Wallpaper" class="w-full h-80 object-cover transition duration-700 group-hover:scale-110 cursor-zoom-in" onclick="openImageModal(this.src)">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent flex flex-col justify-end p-8 opacity-0 group-hover:opacity-100 transition duration-500 text-gray-900 dark:text-white">
                        <h4 class="text-white text-xl font-black italic uppercase mb-4">${img.title}</h4>
                        <a href="${img.src}" download="${img.title}" class="bg-rail-accent text-white text-center py-3 rounded-xl font-black text-xs uppercase tracking-widest shadow-xl">Download Wallpaper</a>
                    </div>
                </div>`).join('');
        }

        function startPollsListener() {
            db.collection('artifacts').doc(currentAppId).collection('public').doc('data').collection('polls').onSnapshot(snap => {
                const polls = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const container = document.getElementById('polls-container'); if (!container || !polls.length) return;
                container.innerHTML = polls.map(p => {
                    const total = p.options.reduce((a, b) => a + b.votes, 0);
                    return `<div class="bg-white dark:bg-rail-dark p-8 md:p-12 rounded-[3.5rem] border-2 border-rail-accent shadow-2xl animate-fade-in text-gray-900 dark:text-white text-gray-900 dark:text-white">
                        <div class="flex items-center gap-3 mb-6"><span class="bg-rail-accent text-white px-3 py-1 rounded-full text-[9px] font-black uppercase">Live Poll</span><h3 class="text-xl md:text-2xl font-black uppercase italic">${escapeHTML(p.question)}</h3></div>
                        <div class="space-y-4">
                            ${p.options.map((opt, i) => {
                                const per = total > 0 ? Math.round((opt.votes / total) * 100) : 0;
                                return `<div class="relative group cursor-pointer" onclick="castVote('${p.id}', ${i})">
                                    <div class="flex justify-between items-center mb-1 px-2 font-bold text-xs"><span>${escapeHTML(opt.text)}</span><span>${per}%</span></div>
                                    <div class="h-10 bg-gray-100 dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-100 dark:border-gray-700">
                                        <div class="poll-bar h-full bg-rail-accent" style="width: ${per}%"></div>
                                    </div>
                                </div>`;
                            }).join('')}
                        </div>
                    </div>`;
                }).join('');
            });
        }

        async function castVote(pollId, idx) {
            const ref = db.collection('artifacts').doc(currentAppId).collection('public').doc('data').collection('polls').doc(pollId);
            await db.runTransaction(async t => {
                const doc = await t.get(ref); if (!doc.exists) return;
                const opts = doc.data().options; opts[idx].votes += 1;
                t.update(ref, { options: opts });
            });
        }

        function startReviewsListener() {
            if (!user) return;
            db.collection('artifacts').doc(currentAppId).collection('public').doc('data').collection('reviews').onSnapshot(snap => {
                allReviews = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                trainsData.forEach(t => { 
                    const filtered = allReviews.filter(r => r.trainId === t.id);
                    if (filtered.length > 0) {
                        const sum = filtered.reduce((a, b) => a + b.rating, 0);
                        t.avgRating = sum / filtered.length; t.reviewCount = filtered.length;
                    } else { t.avgRating = 0; t.reviewCount = 0; }
                });
                renderTrainCards(); 
            }, e => {});
        }

        function renderTrainCards() {
            const grid = document.getElementById('scorecards-grid'); if (!grid) return;
            const sortedTrains = [...trainsData].sort((a, b) => b.avgRating - a.avgRating || b.reviewCount - a.reviewCount);
            grid.innerHTML = sortedTrains.map(t => {
                const fullStars = Math.round(t.avgRating);
                const starDisplay = fullStars > 0 ? '★'.repeat(fullStars) : '☆☆☆☆☆';
                const trainReviews = allReviews.filter(r => r.trainId === t.id).sort((a,b) => b.timestamp - a.timestamp);
                const reviewsHtml = trainReviews.length > 0 
                    ? trainReviews.map(r => `
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-2xl border border-gray-100 dark:border-gray-700 mb-4 text-gray-900 dark:text-white">
                            <div class="flex justify-between mb-2"><p class="text-rail-accent font-black text-[10px] uppercase tracking-widest">${escapeHTML(r.name)}</p><span class="stars text-[10px] font-black">${'★'.repeat(r.rating)}</span></div>
                            <p class="text-gray-600 dark:text-gray-300 font-medium text-sm">"${escapeHTML(r.comment)}"</p>
                            ${r.reply ? `<div class="mt-3 bg-rail-accent/10 p-3 rounded-xl border-l-4 border-rail-accent"><p class="text-[9px] font-black uppercase text-rail-accent mb-1">OFFICIAL REPLY</p><p class="text-xs italic">"${escapeHTML(r.reply)}"</p></div>` : ''}
                            ${adminAuthorised && !r.reply ? `<button onclick="replyToReview('${r.id}')" class="mt-3 text-[10px] font-black uppercase text-rail-accent hover:underline">Reply</button>` : ''}
                        </div>`).join('') : '<p class="italic text-gray-400 text-sm">No feedback yet.</p>';

                return `
                <div class="train-card bg-white dark:bg-rail-dark rounded-3xl border border-gray-100 dark:border-gray-800 shadow-2xl overflow-hidden flex flex-col text-gray-900 dark:text-white">
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                            <div class="md:col-span-3 text-gray-900 dark:text-white">
                                <h3 class="text-2xl font-black italic uppercase">${t.name}</h3>
                                <p class="text-rail-accent font-bold text-xs uppercase mb-4">${t.route}</p>
                                <div class="mb-4 bg-gray-50 dark:bg-gray-900/50 p-3 rounded-xl border border-gray-100 dark:border-gray-800">
                                    <div class="grid grid-cols-2 gap-2 text-gray-900 dark:text-white text-gray-900 dark:text-white text-gray-900 dark:text-white">${t.fares.map(f => `<div class="flex justify-between text-[11px] border-b border-gray-100 dark:border-gray-800 pb-1 font-bold"><span class="text-gray-500">${f.class}</span><span class="text-rail-accent">${f.price}</span></div>`).join('')}</div>
                                </div>
                                <div class="flex justify-between items-center text-sm font-bold pt-3">
                                    <span>Public Score (${t.reviewCount})</span>
                                    <span class="stars text-xl">${starDisplay}</span>
                                </div>
                            </div>
                            <div class="md:col-span-2 relative aspect-video bg-gray-50 dark:bg-gray-900 rounded-xl overflow-hidden slideshow-container">
                                <!-- FIX 7: Added Alt Tag for train slideshows -->
                                ${t.slides.map((s,i)=>`<div class="slide ${i===0?'':'hidden'} text-gray-900 dark:text-white"><img src="images/${s}" alt="${t.name} Journey Preview" class="w-full h-full object-cover" onclick="openImageModal(this.src)"></div>`).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-900/40 p-6 border-t border-gray-100 dark:border-gray-800 mt-auto">
                        <h4 class="text-lg font-black mb-6 text-gray-900 dark:text-white">Passenger Feedback</h4>
                        <div class="max-h-56 overflow-y-auto mb-6 pr-2 custom-scrollbar text-gray-900 dark:text-white">${reviewsHtml}</div>
                        <form onsubmit="postDatabaseReview(event, '${t.id}')" class="space-y-2">
                            <div class="grid grid-cols-2 gap-2 text-gray-900 dark:text-white text-gray-900 dark:text-white"><input type="text" id="name-${t.id}" placeholder="Name" required class="bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-3 rounded-xl text-xs"><select id="rating-${t.id}" class="bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-3 rounded-xl text-xs"><option value="5">5 Stars</option><option value="4">4 Stars</option><option value="3">3 Stars</option><option value="2">2 Stars</option><option value="1">1 Star</option></select></div>
                            <textarea id="comment-${t.id}" placeholder="Feedback..." required class="w-full bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-3 rounded-xl text-xs h-16 text-gray-900 dark:text-white"></textarea>
                            <button type="submit" class="w-full bg-rail-accent text-white py-3 rounded-xl font-black text-xs uppercase text-gray-900 dark:text-white">Post Review</button>
                        </form>
                    </div>
                </div>`;
            }).join('');
        }

        async function postDatabaseReview(e, trainId) {
            e.preventDefault(); if (!user) return;
            const btn = e.target.querySelector('button');
            try {
                btn.disabled = true; btn.innerText = "POSTING...";
                await db.collection('artifacts').doc(currentAppId).collection('public').doc('data').collection('reviews').add({ trainId: trainId, name: document.getElementById(`name-${trainId}`).value, rating: parseInt(document.getElementById(`rating-${trainId}`).value), comment: document.getElementById(`comment-${trainId}`).value, timestamp: Date.now() });
                e.target.reset();
            } catch (err) { } finally { btn.disabled = false; btn.innerText = "POST REVIEW"; }
        }

        function routeTo(e, p){ if(e)e.preventDefault(); window.history.pushState({},"",p); handleRouting(); }
        function handleRouting(){ 
            let p=window.location.pathname.split('/').pop()||'home'; 
            if(p.endsWith('.html'))p=p.replace('.html',''); if(p===''||p==='index')p='home'; 
            document.querySelectorAll('.page-view').forEach(v=>{v.classList.remove('active'); if(v.id===p+'-view')v.classList.add('active');}); 
            if(!document.querySelector('.page-view.active'))document.getElementById('home-view').classList.add('active'); 
            window.scrollTo(0,0); if(p==='home'&&YT_KEY)fetchVideos(yt_duration); if(p==='gallery')renderGallery();
        }
        window.onpopstate = handleRouting;

        async function fetchVideos(d, tok=null, app=false) {
            const container = document.getElementById('video-cards-container'); if (!container || !YT_KEY) return;
            const fd = d.charAt(0).toUpperCase() + d.slice(1);
            try {
                const res = await fetch(`https://www.googleapis.com/youtube/v3/search?key=${YT_KEY}&channelId=${YT_CHANNEL}&part=snippet,id&order=date&maxResults=6&type=video&videoDuration=${fd}${tok?'&pageToken='+tok:''}`);
                const data = await res.json(); yt_token = data.nextPageToken; if (!app) container.innerHTML = '';
                if (data.items) data.items.forEach(v => {
                    container.innerHTML += `<div class="bg-white dark:bg-gray-800 rounded-3xl overflow-hidden shadow-2xl cursor-pointer group transition transform hover:-translate-y-2" onclick="openVideo('${v.id.videoId}')">
                        <div class="aspect-video relative overflow-hidden"><img src="https://img.youtube.com/vi/${v.id.videoId}/maxresdefault.jpg" alt="${v.snippet.title}" class="w-full h-full object-cover transition duration-1000 group-hover:scale-110"><div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition"><svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div></div>
                        <div class="p-6 text-gray-900 dark:text-white text-gray-900 dark:text-white"><h3 class="text-sm font-black line-clamp-2 uppercase">${v.snippet.title}</h3></div></div>`;
                });
            } catch (e) {}
        }

        function fetchUpdates() {
            if (!user) return;
            const container = document.getElementById('updates-container');
            db.collection('artifacts').doc(currentAppId).collection('public').doc('data').collection('updates').onSnapshot(snap => {
                const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a,b) => b.timestamp - a.timestamp);
                if (!data.length) container.innerHTML = '<p class="col-span-full text-center text-gray-500 py-10">No broadcasts.</p>';
                else container.innerHTML = data.map(u => {
                    const react = u.reactions || {like:0,heart:0,fire:0};
                    return `<div class="bg-white dark:bg-gray-800 p-6 rounded-3xl border border-gray-100 dark:border-gray-800 shadow-2xl animate-fade-in transition hover:border-rail-accent text-gray-900 dark:text-white text-gray-900 dark:text-white">
                        <div class="flex justify-between mb-6"><span class="bg-rail-accent text-white text-[10px] font-black px-4 py-2 rounded-full uppercase italic">Official</span><div class="flex items-center gap-2 text-gray-400 text-xs font-black text-gray-900 dark:text-white text-gray-900 dark:text-white"><i class="fas fa-eye text-gray-900 dark:text-white text-gray-900 dark:text-white"></i> <span>${u.views || 0} Views</span></div></div>
                        ${u.imageUrl ? `<img src="${u.imageUrl}" alt="${u.title}" class="w-full h-48 md:h-56 object-cover rounded-2xl mb-6 shadow-xl cursor-zoom-in" onclick="openImageModal(this.src)">` : ''}
                        <h3 class="text-xl font-black mb-4 uppercase">${escapeHTML(u.title)}</h3>
                        <p class="text-gray-600 dark:text-gray-400 font-medium text-sm line-clamp-4">${escapeHTML(u.content)}</p>
                        <div class="mt-6 flex justify-between border-t border-gray-100 dark:border-gray-800 pt-6">
                            <div class="flex gap-4"><button onclick="handleReaction('${u.id}', 'like')">👍 ${react.like}</button><button onclick="handleReaction('${u.id}', 'heart')">❤️ ${react.heart}</button><button onclick="handleReaction('${u.id}', 'fire')">🔥 ${react.fire}</button></div>
                            <button onclick='incrementViewsAndOpen("${u.id}", ${JSON.stringify(u)})' class="text-rail-accent font-black text-xs uppercase hover:underline text-gray-900 dark:text-white text-gray-900 dark:text-white">Read More</button>
                        </div>
                    </div>`;
                }).join('');
            }, e => {});
        }

        async function incrementViewsAndOpen(id, post) { if (!user) return; const ref = db.collection('artifacts').doc(currentAppId).collection('public').doc('data').collection('updates').doc(id); db.runTransaction(async t => { const doc = await t.get(ref); if (!doc.exists) return; t.update(ref, { views: (doc.data().views || 0) + 1 }); }); post.views = (post.views||0)+1; openPostModal(post); }
        function openPostModal(post) { 
            const b = document.getElementById('post-modal-body');
            b.innerHTML = `${post.imageUrl ? `<img src="${post.imageUrl}" alt="${post.title}" class="w-full h-auto object-contain rounded-3xl mb-8 shadow-2xl">` : ''}
                <div class="flex justify-between mb-8"><span class="bg-rail-accent text-white text-[10px] font-black px-4 py-2 rounded-full uppercase italic text-gray-900 dark:text-white">Official Update</span><span class="text-gray-400 text-xs font-black">👁️ ${post.views||0} Views</span></div>
                <h2 class="text-2xl font-black mb-8 uppercase text-gray-900 dark:text-white text-gray-900 dark:text-white">${escapeHTML(post.title)}</h2>
                <div class="text-sm font-medium whitespace-pre-wrap text-gray-600 dark:text-gray-300 text-gray-900 dark:text-white">${escapeHTML(post.content)}</div>`;
            document.getElementById('post-modal').classList.remove('hidden'); document.getElementById('post-modal').classList.add('flex'); document.body.style.overflow = 'hidden';
        }

        function escapeHTML(s) { const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); document.body.style.overflow = 'auto'; if (id==='video-modal') document.getElementById('video-embed-container').innerHTML = ''; }
        function openImageModal(src) { document.getElementById('modal-image-content').src = src; document.getElementById('image-modal').classList.remove('hidden'); document.getElementById('image-modal').classList.add('flex'); document.body.style.overflow = 'hidden'; }
        function closeImageModal() { document.getElementById('image-modal').classList.add('hidden'); document.body.style.overflow = 'auto'; }
        function checkAdmin() { const p = prompt("Admin Key:"); if (p === "railspk786") { adminAuthorised = true; document.getElementById('admin-panel').classList.remove('hidden'); startReviewsListener(); alert("Authorized."); } }
        function initTheme() {
            const b = document.getElementById('theme-toggle'); if(!b) return;
            const isDark = localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
            if (isDark) document.documentElement.classList.add('dark');
            b.addEventListener('click', () => { const nowDark = document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', nowDark ? 'dark' : 'light'); });
        }

        window.addEventListener('DOMContentLoaded', () => {
            initFirebase(); renderTrainCards(); initTheme();
            document.getElementById('video-filter').addEventListener('change', (e) => { yt_duration = e.target.value; fetchVideos(yt_duration); });
            document.getElementById('load-more-btn').addEventListener('click', () => { if (yt_token) fetchVideos(yt_duration, yt_token, true); });
            document.getElementById('update-form').addEventListener('submit', postUpdate);
            document.getElementById('admin-trigger').addEventListener('click', checkAdmin);
            setInterval(() => { const s = document.querySelectorAll('.hero-slide'); if (s.length > 1) { let cur = 0; s.forEach((slide, i) => { if (slide.classList.contains('active')) cur = i; }); s[cur].classList.remove('active'); s[(cur + 1) % s.length].classList.add('active'); } }, 6000);
            setInterval(() => { document.querySelectorAll('.slideshow-container').forEach(c => { const s = c.querySelectorAll('.slide'); if (s.length < 2) return; let cur = -1; s.forEach((slide, i) => { if (!slide.classList.contains('hidden')) cur = i; }); s[cur].classList.add('hidden'); s[(cur + 1) % s.length].classList.remove('hidden'); }); }, 4500);
        });
    </script>

    <!-- Shared Modals -->
    <div id="video-modal" class="hidden fixed inset-0 z-[100] bg-black/98 items-center justify-center p-4 text-gray-900 dark:text-white" onclick="if(event.target.id === 'video-modal') closeModal('video-modal')">
        <div class="bg-black w-full max-w-6xl rounded-[2rem] overflow-hidden shadow-2xl relative border border-white/5">
            <button onclick="closeModal('video-modal')" class="absolute top-4 right-4 text-white text-3xl z-10 hover:text-rail-accent transition">&times;</button>
            <div id="video-embed-container" class="aspect-video"></div>
        </div>
    </div>
    <div id="image-modal" class="hidden fixed inset-0 z-[100] bg-black/98 items-center justify-center p-4 transition-all text-gray-900 dark:text-white" onclick="if(event.target.id === 'image-modal') closeImageModal()">
        <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white text-5xl font-thin hover:text-rail-accent transition font-sans text-gray-900 dark:text-white">&times;</button>
        <img id="modal-image-content" src="" alt="Full Screen View" class="max-w-full max-h-full object-contain rounded-xl border border-white/10 shadow-2xl">
    </div>
    <div id="post-modal" class="hidden fixed inset-0 z-[100] bg-black/95 items-center justify-center p-4 overflow-y-auto" onclick="if(event.target.id === 'post-modal') closeModal('post-modal')">
        <div class="bg-white dark:bg-rail-dark w-full max-w-4xl rounded-[2.5rem] shadow-2xl relative border border-gray-100 dark:border-white/5 my-8">
            <button onclick="closeModal('post-modal')" class="fixed top-8 right-8 text-gray-400 hover:text-rail-accent text-5xl font-thin transition z-[110]">&times;</button>
            <div id="post-modal-body" class="p-8 md:p-16 max-h-[85vh] overflow-y-auto custom-scrollbar text-gray-900 dark:text-white"></div>
        </div>
    </div>
</body>
</html>