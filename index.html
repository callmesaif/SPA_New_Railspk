<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary SEO -->
    <title id="site-title">RAILSPK - Pakistan Railways Hub | Reviews & Vlogs</title>
    <meta name="description" content="Official portal for Pakistan Railways. Explore high-res wallpapers, passenger reviews, live train fares, and cinematic travel vlogs.">
    <meta name="keywords" content="pakistan railway, train vlogs, train reviews, pakistan railways, train tracking pakistan, ratings, trains, pakistan, pakistan railways ticket booking, ticket booking pakistan, railoverspk, railspk, train vlogger, track my train pakistan railways, travel pakistan, travel by train">
    <meta name="author" content="RAILSPK Team">

    <link rel="canonical" href="https://therails.pk/" />
    <link rel="icon" href="images/favicon.ico?v=3" type="image/x-icon">
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://quge5.com/88/tag.min.js" data-zone="199516" async data-cfasync="false"></script>
	
    <!-- Open Graph for Social Sharing -->
    <meta property="og:title" content="The RAILSPK - Digital Pakistan Railways Portal">
    <meta property="og:description" content="Cinematic vlogs, train scorecards, and a community for railway enthusiasts.">
    <meta property="og:image" content="images/train_background2.webp">
    <meta property="og:url" content="https://therails.pk/">

    <!-- --- SCHEMA MARKUP (JSON-LD) --- -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "The RAILSPK",
      "url": "https://therails.pk",
      "logo": "https://therails.pk/images/favicon.ico",
      "sameAs": [
        "https://facebook.com/therailspk",
        "https://youtube.com/@therailspk",
        "https://instagram.com/therailspk"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "url": "https://therails.pk/community"
      }
    }
    </script>
	
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "The RAILSPK",
      "url": "https://therails.pk",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://therails.pk/reviews?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>

    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        .dark ::-webkit-scrollbar-track { background: #1e293b; }
        .dark ::-webkit-scrollbar-thumb { background: #6366f1; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }
        html { scroll-behavior: smooth; }
        
        /* --- HERO STYLES (Static) --- */

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        .dark ::-webkit-scrollbar-track { background: #1e293b; }
        .dark ::-webkit-scrollbar-thumb { background: #6366f1; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }
        html { scroll-behavior: smooth; }
        
        /* --- DYNAMIC BANNER STYLES --- */
        #hero-section { 
            position: relative; 
            min-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            overflow: hidden;
        }
        .hero-background { 
            position: absolute; 
            inset: 0; 
            background-size: cover; 
            background-position: center;
            background-image: url('images/train_background.webp');
            transform: scale(1.1);
            filter: brightness(0.6);
        }
        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), #111827);
        }
        
        .page-view { display: none; }
        .page-view.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        
        .stars { color: #f59e0b !important; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }

        .slider-btn {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
        }
        .slider-btn:hover { background: #4f46e5; transform: scale(1.1); }

        /* Skeleton effect images ke liye */
        .img-loading { background: #1e293b; position: relative; overflow: hidden; }
        .img-loading::after {
            content: ""; position: absolute; inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: skeleton-move 1.5s infinite;
        }
        @keyframes skeleton-move { from { transform: translateX(-100%); } to { transform: translateX(100%); } }

        /* Train Badge Styles for Banner */
        .train-badge {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .train-badge:hover {
            background: #4f46e5;
            transform: translateY(-5px);
        }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { 'rail-dark': '#111827', 'rail-accent': '#4f46e5' } } }
        }
    </script>
</head>
<body class="bg-white text-gray-900 dark:bg-rail-dark dark:text-gray-200 transition-colors duration-300 antialiased overflow-x-hidden">

    <header class="sticky top-0 z-50 bg-white/90 dark:bg-rail-dark/95 backdrop-blur-md shadow-sm border-b border-gray-100 dark:border-white/5">
        <div class="max-w-screen-2xl mx-auto px-4 flex justify-between items-center h-16 md:h-20">
            <a href="/home" onclick="routeTo(event, '/home')" class="text-2xl md:text-3xl font-black tracking-tighter">
                The <span class="text-rail-accent">RAILSPK</span>
            </a>
            
            <div class="flex items-center space-x-4">
                <nav class="hidden lg:flex space-x-8 text-[11px] font-black uppercase tracking-[0.2em]">
                    <a href="/home" onclick="routeTo(event, '/home')" class="hover:text-rail-accent transition-colors">Home</a>
                    <a href="/gallery" onclick="routeTo(event, '/gallery')" class="hover:text-rail-accent transition-colors">Gallery</a>
                    <a href="/reviews" onclick="routeTo(event, '/reviews')" class="hover:text-rail-accent transition-colors">Reviews</a> 
                    <a href="/community" onclick="routeTo(event, '/community')" class="hover:text-rail-accent transition-colors">Community</a>
					<a href="/about" onclick="routeTo(event, '/about')" class="hover:text-rail-accent transition-colors">About</a>

                </nav>

                <div class="flex items-center space-x-2 border-l border-gray-100 dark:border-gray-800 pl-4">
                    <button id="admin-trigger" class="px-4 py-2 bg-rail-accent/10 text-rail-accent rounded-full text-[10px] font-black uppercase hover:bg-rail-accent hover:text-white transition">Admin</button>
                    
                    <button id="theme-toggle" class="w-10 h-10 flex items-center justify-center rounded-xl bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 hover:text-rail-accent border border-gray-100 dark:border-gray-700 transition">
                        <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                        <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 0zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"></path></svg>
                    </button>
                    
                    <button class="lg:hidden p-2 text-gray-600 dark:text-gray-400" onclick="toggleMenu()" aria-label="Toggle Menu">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16m-7 6h7" stroke-width="2.5" stroke-linecap="round"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        
        <div id="mobile-menu" class="hidden lg:hidden bg-white dark:bg-rail-dark border-b border-gray-100 dark:border-gray-800 p-6 space-y-4 absolute w-full shadow-2xl z-50">
            <a href="/home" class="block font-black uppercase text-sm" onclick="routeTo(event, '/home'); toggleMenu();">Home</a>
            <a href="/gallery" class="block font-black uppercase text-sm" onclick="routeTo(event, '/gallery'); toggleMenu();">Gallery</a>
            <a href="/reviews" class="block font-black uppercase text-sm" onclick="routeTo(event, '/reviews'); toggleMenu();">Reviews</a>
            <a href="/community" class="block font-black uppercase text-sm" onclick="routeTo(event, '/community'); toggleMenu();">Community</a>
			<a href="/about" class="block font-black uppercase text-sm" onclick="routeTo(event, '/about'); toggleMenu();">About</a>
        </div>
    </header>

    <main id="main-content">
        <!-- --- HOME VIEW --- -->
        <section id="home-view" class="page-view active">
            <!-- New Immersive Banner -->
            <div id="hero-section">
                <div class="hero-background"></div>
                <div class="hero-overlay"></div>
                
                <div class="relative z-10 max-w-screen-xl mx-auto px-6 pt-20 pb-12 flex flex-col items-center text-center text-white">
                    <h1 class="text-6xl md:text-[12rem] font-black mb-6 tracking-tighter uppercase italic drop-shadow-2xl leading-none">
                        THE <span class="text-rail-accent">RAILSPK</span>
                    </h1>
                    
                    <!-- Motive Statement -->
                    <p class="text-lg md:text-3xl mb-12 text-gray-300 font-light max-w-4xl leading-relaxed italic">
                        "Documenting and preserving the <span class="text-white font-bold">Digital Legacy</span> of Pakistan Railways through cinematic storytelling and data-driven insights."
                    </p>
                    
                    <!-- Featured Trains Badges -->
                    <div class="flex flex-wrap justify-center gap-4 mb-12">
                        <div class="train-badge px-6 py-3 rounded-2xl flex items-center space-x-3 cursor-pointer" onclick="routeTo(event, '/reviews')">
                            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            <span class="text-[10px] font-black uppercase tracking-widest">Green Line Express</span>
                        </div>
                        <div class="train-badge px-6 py-3 rounded-2xl flex items-center space-x-3 cursor-pointer" onclick="routeTo(event, '/reviews')">
                            <span class="w-2 h-2 bg-orange-500 rounded-full animate-pulse"></span>
                            <span class="text-[10px] font-black uppercase tracking-widest">Shalimar Express</span>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-6">
                        <a href="/reviews" onclick="routeTo(event, '/reviews')" class="bg-rail-accent text-white px-12 py-5 rounded-2xl font-black uppercase tracking-[0.2em] shadow-2xl transition hover:scale-105">Check Reviews</a>
                        <a href="/community" onclick="routeTo(event, '/community')" class="bg-white/5 backdrop-blur-xl border border-white/10 text-white px-12 py-5 rounded-2xl font-black uppercase tracking-[0.2em] hover:bg-white/10 transition">Visit Community</a>
                    </div>
                </div>
            </div>

            <div class="max-w-screen-2xl mx-auto px-4 py-16 md:py-24">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 gap-6">
                    <div>
                        <h2 class="text-3xl md:text-5xl font-black uppercase italic text-gray-900 dark:text-white">Latest <span class="text-rail-accent">Vlogs</span></h2>
                        <p class="text-gray-500 dark:text-gray-400 font-medium mt-2">Discover high-quality cinematic railway journeys.</p>
                    </div>
                    <select id="video-filter" class="w-full md:w-auto bg-gray-50 dark:bg-gray-800 border-none rounded-xl p-4 outline-none ring-1 ring-gray-100 dark:ring-gray-700 font-black uppercase text-xs text-gray-900 dark:text-white">
                        <option value="long">Long Episodes</option>
                        <option value="medium">Medium Content</option>
                        <option value="short">Short Clips</option>
                    </select>
                </div>
                <div id="video-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                <div class="mt-16 text-center">
                    <button id="load-more-btn" class="bg-rail-accent text-white px-12 py-5 rounded-2xl font-black uppercase tracking-widest shadow-2xl transition hover:scale-105">Load More Content</button>
                </div>
            </div>
        </section>

        <!-- --- GALLERY VIEW --- -->
        <section id="gallery-view" class="page-view">
            <div class="max-w-screen-2xl mx-auto px-4 py-20 text-center">
                <h2 class="text-4xl md:text-7xl font-black uppercase italic mb-4 text-gray-900 dark:text-white">Railway <span class="text-rail-accent">Gallery</span></h2>
                <p class="text-gray-500 uppercase tracking-[0.3em] text-xs font-black mb-16">High-Definition Wallpapers</p>
                <div id="gallery-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 text-left"></div>
            </div>
        </section>

        <!-- --- REVIEWS VIEW --- -->
        <section id="reviews-view" class="page-view">
            <div class="max-w-screen-2xl mx-auto px-4 py-20">
                <h2 class="text-4xl md:text-7xl font-black text-center uppercase italic mb-16 text-gray-900 dark:text-white">Train <span class="text-rail-accent">Scorecards</span></h2>
                <div id="scorecards-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-10"></div>
            </div>
        </section>

        <!-- --- COMMUNITY VIEW --- -->
        <section id="community-view" class="page-view">
            <div class="max-w-screen-xl mx-auto px-4 py-20">
                <div class="flex justify-between items-center mb-16 pb-8 border-b border-gray-100 dark:border-gray-800">
                    <h2 class="text-4xl md:text-7xl font-black uppercase italic text-gray-900 dark:text-white">Railway <span class="text-rail-accent">Cloud</span></h2>
                    <span class="text-[10px] font-black uppercase tracking-widest text-gray-400 hidden sm:block">Live Updates</span>
                </div>
                
                <div id="polls-container" class="mb-16 space-y-8"></div>
                
                <div id="admin-panel" class="hidden mb-16 bg-rail-accent/5 border-2 border-dashed border-rail-accent p-8 md:p-12 rounded-[2.5rem]">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                        <div>
                            <h3 class="text-2xl font-black text-rail-accent uppercase italic mb-8">Post Broadcast</h3>
                            <form id="update-form" class="space-y-4">
                                <input type="text" id="update-title" placeholder="Broadcast Headline" required class="w-full bg-white dark:bg-gray-800 p-4 rounded-2xl outline-none ring-1 ring-gray-100 dark:ring-gray-700 text-gray-900 dark:text-white">
                                <input type="file" id="update-image-file" accept="image/*" class="w-full bg-white dark:bg-gray-800 p-4 rounded-2xl text-xs text-gray-900 dark:text-white">
                                <textarea id="update-content" placeholder="Broadcast message details..." required class="w-full bg-white dark:bg-gray-800 p-4 rounded-2xl h-32 text-gray-900 dark:text-white"></textarea>
                                <button type="submit" id="update-btn" class="w-full bg-rail-accent text-white py-5 rounded-2xl font-black uppercase tracking-widest shadow-xl transition-all">
                                    <span id="update-btn-text">Publish to Cloud</span>
                                </button>
                            </form>
                        </div>
                        <div>
                            <h3 class="text-2xl font-black text-rail-accent uppercase italic mb-8">New Interaction</h3>
                            <form id="poll-form" class="space-y-4">
                                <input type="text" id="poll-question" placeholder="Ask the community..." required class="w-full bg-white dark:bg-gray-800 p-4 rounded-2xl outline-none ring-1 ring-gray-100 dark:ring-gray-700 text-gray-900 dark:text-white">
                                <input type="text" id="poll-options" placeholder="Option 1, Option 2, Option 3 (comma separated)" required class="w-full bg-white dark:bg-gray-800 p-4 rounded-2xl outline-none ring-1 ring-gray-100 dark:ring-gray-700 text-gray-900 dark:text-white">
                                <button type="submit" class="w-full bg-gray-900 dark:bg-white text-white dark:text-gray-900 py-5 rounded-2xl font-black uppercase tracking-widest">Create Live Poll</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div id="updates-container" class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <p id="updates-status" class="col-span-full text-center py-20 text-gray-400 font-black uppercase tracking-[0.3em] animate-pulse italic">Connecting to RAILSPK Cloud...</p>
                </div>
            </div>
        </section>

        <!-- --- ABOUT VIEW --- -->
        <section id="about-view" class="page-view">
            <div class="max-w-screen-xl mx-auto px-6 py-24 md:py-36 text-center">
                <h2 class="text-6xl md:text-9xl font-black tracking-tighter uppercase italic mb-12 text-gray-900 dark:text-white">THE MISSION</h2>
                <p class="text-xl md:text-4xl text-gray-500 dark:text-gray-400 leading-relaxed max-w-5xl mx-auto font-light mb-24">
                    Documenting the heritage and modern evolution of Pakistan Railways through cinematic storytelling and data-driven insights.
                </p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                    <div class="bg-gray-50 dark:bg-gray-800/40 p-10 rounded-[3rem] border border-gray-100 dark:border-gray-800">
                        <span class="text-4xl md:text-6xl font-black text-rail-accent block italic mb-2">35K+</span>
                        <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Subscribers</span>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-800/40 p-10 rounded-[3rem] border border-gray-100 dark:border-gray-800">
                        <span class="text-4xl md:text-6xl font-black text-rail-accent block italic mb-2">5M+</span>
                        <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Total Reach</span>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-800/40 p-10 rounded-[3rem] border border-gray-100 dark:border-gray-800">
                        <span class="text-4xl md:text-6xl font-black text-rail-accent block italic mb-2">150+</span>
                        <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Vlogs</span>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-800/40 p-10 rounded-[3rem] border border-gray-100 dark:border-gray-800">
                        <span class="text-4xl md:text-6xl font-black text-rail-accent block italic mb-2">17</span>
                        <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Express Trains</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- --- TERMS OF SERVICE VIEW --- -->
        <section id="terms-view" class="page-view">
            <div class="max-w-4xl mx-auto px-6 py-20 text-gray-700 dark:text-gray-300">
                <h2 class="text-4xl font-black uppercase italic mb-10 text-rail-accent">Terms of Service</h2>
                <div class="space-y-6 leading-relaxed text-gray-600 dark:text-gray-400 text-left">
                    <p><strong>Effective Date:</strong> January 1, 2025</p>
                    <p>Welcome to The RAILSPK Hub. By using this platform, you agree to our terms and conditions. This website is dedicated to providing educational and documentary content regarding Pakistan Railways.</p>
                    
                    <h3 class="text-xl font-black uppercase text-gray-900 dark:text-white">Intellectual Property</h3>
                    <p>All cinematic vlogs, high-resolution photographs, and digital data sets are the exclusive property of The RAILSPK. You may not reproduce, redistribute, or exploit this content for commercial purposes without explicit written authorization.</p>
                    
                    <h3 class="text-xl font-black uppercase text-gray-900 dark:text-white">User Contributions</h3>
                    <p>When you post reviews or participate in community polls, you grant us a non-exclusive license to display that content. You must ensure that your contributions are respectful and do not violate third-party rights or ethical standards.</p>
                    
                    <h3 class="text-xl font-black uppercase text-gray-900 dark:text-white">Disclaimer</h3>
                    <p>While we strive for accuracy, The RAILSPK is not liable for any discrepancies in fare data or schedule information. Information can change without notice; always confirm with official Pakistan Railways counters before travel.</p>
                </div>
            </div>
        </section>

        <!-- --- PRIVACY POLICY VIEW --- -->
        <section id="privacy-view" class="page-view">
            <div class="max-w-4xl mx-auto px-6 py-20 text-gray-700 dark:text-gray-300">
                <h2 class="text-4xl font-black uppercase italic mb-10 text-rail-accent">Privacy Policy</h2>
                <div class="space-y-6 leading-relaxed text-gray-600 dark:text-gray-400 text-left">
                    <p><strong>Effective Date:</strong> January 1, 2025</p>
                    <p>The RAILSPK Hub ("we") is committed to protecting your digital privacy. This policy explains our data practices for this platform.</p>
                    
                    <h3 class="text-xl font-black uppercase text-gray-900 dark:text-white">Data Protection</h3>
                    <p>We do not collect personally identifiable information (PII) such as emails or phone numbers for general browsing. User participation in reviews and polls is tracked via anonymous Firebase identifiers to ensure system integrity.</p>
                    
                    <h3 class="text-xl font-black uppercase text-gray-900 dark:text-white">Technical Storage</h3>
                    <p>We use browser Local Storage only to remember your preference for Dark Mode and to maintain secure, anonymous session tokens. We do not use persistent tracking cookies for advertising.</p>
                    
                    <h3 class="text-xl font-black uppercase text-gray-900 dark:text-white">Third-Party Services</h3>
                    <p>This platform utilizes YouTube API Services to display vlogs and Firebase Firestore for community data management. By using this site, you agree to comply with their respective privacy terms.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="py-20 border-t border-gray-100 dark:border-gray-800 text-center px-6">
        <div class="flex justify-center space-x-10 mb-12">
            <a href="https://facebook.com/therailspk" rel="nofollow" target="_blank" class="text-3xl text-gray-400 hover:text-[#1877F2] transition-colors"><i class="fab fa-facebook"></i></a>
            <a href="https://youtube.com/@therailspk" rel="nofollow" target="_blank" class="text-3xl text-gray-400 hover:text-[#FF0000] transition-colors"><i class="fab fa-youtube"></i></a>
            <a href="https://instagram.com/therailspk" rel="nofollow" target="_blank" class="text-3xl text-gray-400 hover:text-[#E4405F] transition-colors"><i class="fab fa-instagram"></i></a>
            <a href="https://whatsapp.com/channel/0029VbBHeff8PgsJZYRHwv3O" rel="nofollow" target="_blank" class="text-3xl text-gray-400 hover:text-[#25D366] transition-colors"><i class="fab fa-whatsapp"></i></a>
        </div>
        <p class="text-gray-400 text-[10px] tracking-[0.5em] font-black uppercase italic mb-6">¬© 2025 The RAILSPK | Digital Legacy Project</p>
        <div class="flex justify-center space-x-8 text-[10px] font-black uppercase tracking-widest text-gray-500">
            <a href="/privacy" onclick="routeTo(event, '/privacy')" class="hover:text-rail-accent transition">Privacy Policy</a>
            <a href="/terms" onclick="routeTo(event, '/terms')" class="hover:text-rail-accent transition">Terms of Service</a>
        </div>
    </footer>

    <script>
        // --- CONFIGURATION & STATE ---
        let db, auth, user, adminAuthorised = false;
        let YT_KEY = "AIzaSyAax2bSR8u33U5DKCSt8ffEmEyGHbnquWU", YT_CHANNEL = "UC0jiPBcE-2QbiBLt2m3MHSQ";
        let yt_token = null, yt_duration = 'long', allReviews = [];
        
        let currentSliderImages = [];
        let currentSliderIndex = 0;

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'railspk-official-1de54'; 
        const firebaseConfig = { apiKey: "AIzaSyCfoXeQk-6ubcJZz3ES7c6yE2IWSFp2z9A", authDomain: "railspk-official-1de54.firebaseapp.com", projectId: "railspk-official-1de54", storageBucket: "railspk-official-1de54.firebasestorage.app", messagingSenderId: "282037027182", appId: "1:282037027182:web:6b4f8bb420eb410374c17f" };

        const trainsData = [
            { id: 'khybermail', name: 'Khyber Mail Express', route: 'Karachi ‚ü∑ Peshawar', slides: ['coming_soon.avif'], fares: [{class:"AC Sleeper",price:"Rs. 13,000"},{class:"AC Business",price:"Rs. 9,500"},{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 4,000"}] },
            { id: 'greenline', name: 'Green Line Express', route: 'Karachi ‚ü∑ Islamabad', slides: ['greenline_7.webp','greenline_2.webp','greenline_3.webp','greenline_4.webp','greenline_5.webp','greenline_6.webp','greenline_1.webp','greenline_8.webp','greenline_9.webp'], fares: [{class:"AC Parlor",price:"Rs. 13,500"},{class:"AC Business",price:"Rs. 11,500"},{class:"AC Standard",price:"Rs. 9,000"},{class:"Economy",price:"Rs. 4,500"}] },
            { id: 'tezgam', name: 'Tezgam Express', route: 'Karachi ‚ü∑ Rawalpindi', slides: ['coming_soon.avif'], fares: [{class:"AC Sleeper",price:"Rs. 12,000"},{class:"AC Business",price:"Rs. 9,000"},{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,800"}] },
            { id: 'allamaiqbal', name: 'Allama Iqbal Express', route: 'Karachi ‚ü∑ Sialkot', slides: ['allama_1.webp'], fares: [{class:"AC Standard",price:"Rs. 6,800"},{class:"Economy",price:"Rs. 3,500"}] },
            { id: 'hazara', name: 'Hazara Express', route: 'Karachi ‚ü∑ Havelian', slides: ['coming_soon.avif'], fares: [{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,600"}] },
            { id: 'awam', name: 'Awam Express', route: 'Karachi ‚ü∑ Peshawar', slides: ['coming_soon.avif'], fares: [{class:"AC Business",price:"Rs. 9,500"},{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 3,800"}] },
            { id: 'karachi', name: 'Karachi Express', route: 'Karachi ‚ü∑ Lahore', slides: ['coming_soon.avif'], fares: [{class:"AC Sleeper",price:"Rs. 11,500"},{class:"AC Business",price:"Rs. 9,500"},{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 3,800"}] },
            { id: 'millat', name: 'Millat Express', route: 'Karachi ‚ü∑ Faisalabad', slides: ['coming_soon.avif'], fares: [{class:"AC Business",price:"Rs. 9,000"},{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,500"}] },
            { id: 'shalimar', name: 'Shalimar Express', route: 'Karachi ‚ü∑ Lahore', slides: ['shalimar_1.webp','shalimar_2.webp','shalimar_3.webp','shalimar_4.webp','shalimar_5.webp','shalimar_6.webp','shalimar_7.webp','shalimar_8.webp'], fares: [{class:"AC Parlor",price:"Rs. 11,000"},{class:"AC Business",price:"Rs. 9,000"},{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,500"}] },
            { id: 'pakbusiness', name: 'Pak Business Express', route: 'Karachi ‚ü∑ Lahore', slides: ['business_1.webp','business_2.webp','business_3.webp','business_4.webp','business_5.webp','business_6.webp','business_7.webp'], fares: [{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 3,800"}] },
            { id: 'fareed', name: 'Fareed Express', route: 'Karachi ‚ü∑ Lahore (PKP)', slides: ['coming_soon.avif'], fares: [{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,500"}] },
            { id: 'karakoram', name: 'Karakoram Express', route: 'Karachi ‚ü∑ Lahore', slides: ['coming_soon.avif'], fares: [{class:"AC Business",price:"Rs. 9,500"},{class:"AC Standard",price:"Rs. 7,500"},{class:"Economy",price:"Rs. 4,000"}] },
            { id: 'pakistanexp', name: 'Pakistan Express', route: 'Karachi ‚ü∑ Rawalpindi', slides: ['coming_soon.avif'], fares: [{class:"AC Standard",price:"Rs. 7,000"},{class:"Economy",price:"Rs. 3,600"}] },
            { id: 'rehmanbaba', name: 'Rehman Baba Express', route: 'Karachi ‚ü∑ Peshawar', slides: ['coming_soon.avif'], fares: [{class:"AC Business",price:"Rs. 10,000"},{class:"AC Standard",price:"Rs. 8,000"},{class:"Economy",price:"Rs. 4,200"}] },
            { id: 'sukkur', name: 'Sukkur Express', route: 'Karachi ‚ü∑ Sukkur', slides: ['coming_soon.avif'], fares: [{class:"AC Sleeper",price:"Rs. 7,000"},{class:"AC Business",price:"Rs. 5,000"},{class:"AC Standard",price:"Rs. 4,000"},{class:"Economy",price:"Rs. 2,200"}] },
            { id: 'mehran', name: 'Mehran Express', route: 'Karachi ‚ü∑ Mirpur Khas', slides: ['mehran_4.webp','mehran_2.webp','mehran_3.webp','mehran_1.webp'], fares: [{class:"Economy",price:"Rs. 800"}] },
            { id: 'shahlatif', name: 'Shah Latif Express', route: 'Karachi ‚ü∑ Mirpur Khas', slides: ['coming_soon.avif'], fares: [{class:"Economy",price:"Rs. 800"}] }
        ];

        const galleryData = [
            { title: "Green Line Dawn", src: "images/train_background.webp" },
            { title: "Railway Track Symmetry", src: "images/train_background2.webp" },
            { title: "ZCU-30 Locomotive at Lahore Junction", src: "images/zcu30_locomotive.webp" },
            { title: "ZCU-20 leading Allama Iqbal Express", src: "images/zcu20_locomotive.webp" },
            { title: "Subak Kharam Railcar", src: "images/railcar_new_train.webp" },
            { title: "GEU-40 with Green line train", src: "images/geu40_locomotive.webp" },


        ];

        // --- CORE NAVIGATION ---
        function routeTo(e, p){ 
            if(e) e.preventDefault(); 
            window.history.pushState({}, "", p); 
            handleRouting(); 
        }

        function handleRouting(){ 
            let p = window.location.pathname.split('/').pop() || 'home'; 
            if(p.endsWith('.html')) p = p.replace('.html', ''); 
            if(p === '' || p === 'index') p = 'home'; 
            
            document.querySelectorAll('.page-view').forEach(v => {
                v.classList.toggle('active', v.id === p + '-view');
            }); 
            
            if(!document.querySelector('.page-view.active')) {
                document.getElementById('home-view').classList.add('active');
            }

            window.scrollTo(0, 0); 
            if(p === 'home' && YT_KEY) fetchVideos(yt_duration); 
            if(p === 'gallery') renderGallery();
        }

        function toggleMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        function initTheme() {
            const b = document.getElementById('theme-toggle');
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            if(!b || !darkIcon || !lightIcon) return;

            const isDark = localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
            if (isDark) { document.documentElement.classList.add('dark'); lightIcon.classList.remove('hidden'); } 
            else { document.documentElement.classList.remove('dark'); darkIcon.classList.remove('hidden'); }

            b.onclick = () => {
                const nowDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', nowDark ? 'dark' : 'light');
                darkIcon.classList.toggle('hidden', nowDark);
                lightIcon.classList.toggle('hidden', !nowDark);
            };
        }

        async function initFirebase() {
            try {
                if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
                db = firebase.firestore(); 
                auth = firebase.auth();
                auth.onAuthStateChanged(async (u) => {
                    user = u; 
                    if (user) { 
                        startReviewsListener(); 
                        startPollsListener(); 
                        fetchUpdates(); 
                        handleRouting(); 
                    }
                });
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await auth.signInWithCustomToken(__initial_auth_token).catch(() => auth.signInAnonymously());
                } else { await auth.signInAnonymously(); }
            } catch (e) { console.error(e); }
        }

        function checkAdmin() {
            const p = prompt("Admin Key:");
            if (p === "railspk786") {
                adminAuthorised = true;
                document.getElementById('admin-panel').classList.remove('hidden');
                renderTrainCards(); 
                routeTo(null, '/community');
            } else { alert("Unauthorized."); }
        }

        async function postUpdate(e) {
            e.preventDefault();
            if (!adminAuthorised || !user) return;
            const btn = document.getElementById('update-btn');
            const btnText = document.getElementById('update-btn-text');
            const title = document.getElementById('update-title').value;
            const content = document.getElementById('update-content').value;
            const imageFile = document.getElementById('update-image-file').files[0];
            let imageUrl = "";

            try {
                btn.disabled = true; btnText.innerText = "PUBLISHING...";
                if (imageFile) {
                    imageUrl = await new Promise(r => {
                        const reader = new FileReader();
                        reader.onloadend = () => r(reader.result);
                        reader.readAsDataURL(imageFile);
                    });
                }
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('updates').add({
                    title, content, imageUrl, views: 0, reactions: { like: 0, heart: 0, fire: 0 }, timestamp: Date.now()
                });
                document.getElementById('update-form').reset();
                alert("Published!");
            } catch (err) { alert("Failed."); } finally { btn.disabled = false; btnText.innerText = "Publish to Cloud"; }
        }

        function fetchUpdates() {
            if (!user) return;
            const container = document.getElementById('updates-container');
            db.collection('artifacts').doc(appId).collection('public').doc('data').collection('updates').onSnapshot(snap => {
                const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a,b)=>b.timestamp-a.timestamp);
                if (!container) return;
                document.getElementById('updates-status')?.classList.add('hidden');
                container.innerHTML = data.map(u => {
                    const react = u.reactions || {like:0,heart:0,fire:0};
                    return `
                    <div class="bg-white dark:bg-gray-800 p-8 rounded-[2.5rem] border border-gray-100 dark:border-gray-800 shadow-xl text-gray-900 dark:text-white transition-all hover:border-rail-accent text-left">
                        <div class="flex justify-between mb-6"><span class="bg-rail-accent text-white text-[10px] font-black px-4 py-2 rounded-full uppercase italic">Official Update</span><span class="text-gray-400 text-xs font-black">üëÅÔ∏è ${u.views||0}</span></div>
                        ${u.imageUrl ? `<img src="${u.imageUrl}" loading="lazy" class="w-full h-56 object-cover rounded-3xl mb-6 shadow-xl cursor-zoom-in" onclick="openSliderModal(['${u.imageUrl}'], 0)">` : ''}
                        <h3 class="text-xl font-black uppercase mb-4 text-gray-900 dark:text-white">${escapeHTML(u.title)}</h3>
                        <p class="text-gray-500 dark:text-gray-400 text-sm font-medium leading-relaxed line-clamp-4">${escapeHTML(u.content)}</p>
                        <div class="mt-8 flex justify-between items-center border-t border-gray-100 dark:border-gray-700 pt-6">
                            <div class="flex space-x-4">
                                <button onclick="handleReaction('${u.id}', 'like')" class="hover:scale-110 transition">üëç ${react.like}</button>
                                <button onclick="handleReaction('${u.id}', 'heart')" class="hover:scale-110 transition">‚ù§Ô∏è ${react.heart}</button>
                                <button onclick="handleReaction('${u.id}', 'fire')" class="hover:scale-110 transition">üî• ${react.fire}</button>
                            </div>
                            <button onclick='incrementViewsAndOpen("${u.id}", ${JSON.stringify(u).replace(/"/g, '&quot;')})' class="text-rail-accent font-black text-xs uppercase hover:underline">Explore More</button>
                        </div>
                    </div>`;
                }).join('') || '<p class="col-span-full text-center py-20 text-gray-400 font-bold uppercase tracking-widest text-sm">No broadcasts found.</p>';
            });
        }

        async function handleReaction(id, type) {
            if (!user) return;
            const ref = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('updates').doc(id);
            await db.runTransaction(async t => {
                const doc = await t.get(ref); if (!doc.exists) return;
                const reactions = doc.data().reactions || {like:0,heart:0,fire:0};
                reactions[type] = (reactions[type] || 0) + 1;
                t.update(ref, { reactions });
            });
        }

        async function incrementViewsAndOpen(id, post) {
            if (!user) return;
            const ref = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('updates').doc(id);
            db.runTransaction(async t => {
                const doc = await t.get(ref); if (!doc.exists) return;
                t.update(ref, { views: (doc.data().views||0) + 1 });
            });
            const body = document.getElementById('post-modal-body');
            body.innerHTML = `
                ${post.imageUrl ? `<img src="${post.imageUrl}" class="w-full h-auto rounded-3xl mb-8 shadow-2xl">` : ''}
                <div class="flex justify-between items-center mb-6 text-[10px] font-black uppercase text-gray-400"><span>Official Broadcast</span><span>üëÅÔ∏è ${post.views+1} Views</span></div>
                <h2 class="text-3xl font-black uppercase italic mb-8 text-gray-900 dark:text-white text-left">${escapeHTML(post.title)}</h2>
                <div class="whitespace-pre-wrap leading-relaxed text-gray-600 dark:text-gray-300 font-medium text-left">${escapeHTML(post.content)}</div>`;
            document.getElementById('post-modal').classList.remove('hidden');
            document.getElementById('post-modal').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function startReviewsListener() {
            if (!user) return;
            db.collection('artifacts').doc(appId).collection('public').doc('data').collection('reviews').onSnapshot(snap => {
                allReviews = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderTrainCards(); 
            });
        }

        function renderTrainCards() {
            const grid = document.getElementById('scorecards-grid'); if (!grid) return;
            const processed = trainsData.map(t => {
                const filtered = allReviews.filter(r => r.trainId === t.id);
                const avg = filtered.length ? filtered.reduce((a, b) => a + b.rating, 0) / filtered.length : 0;
                return { ...t, avg, reviewCount: filtered.length, filteredReviews: filtered };
            }).sort((a, b) => b.avg - a.avg || b.reviewCount - a.reviewCount);

            grid.innerHTML = processed.map(t => {
                const star = '‚òÖ'.repeat(Math.round(t.avg)) || '‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ';
                const reviewsHtml = t.filteredReviews.sort((a,b)=>b.timestamp-a.timestamp).map(r => `
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-xl mb-4 border border-gray-100 dark:border-gray-700 text-gray-900 dark:text-white text-left">
                        <div class="flex justify-between text-[10px] font-black uppercase text-rail-accent mb-1"><span>${escapeHTML(r.name)}</span><span class="stars font-bold text-sm">${'‚òÖ'.repeat(r.rating)}</span></div>
                        <p class="text-xs italic mb-2 text-gray-600 dark:text-gray-400">"${escapeHTML(r.comment)}"</p>
                    </div>`).join('') || '<p class="text-gray-400 text-xs italic">No ratings yet.</p>';

                const fullSlidePaths = t.slides.map(s => 'images/' + s);
                
                // FIXED: Preload images in background to remove slider lag
                fullSlidePaths.forEach(src => { const img = new Image(); img.src = src; });

                return `
                <div class="bg-white dark:bg-rail-dark rounded-[2.5rem] border border-gray-100 dark:border-gray-800 shadow-xl overflow-hidden flex flex-col">
                    <div class="p-8">
                        <div class="flex flex-col md:flex-row gap-8">
                            <div class="flex-1 text-left">
                                <h3 class="text-3xl font-black italic uppercase text-gray-900 dark:text-white">${t.name}</h3>
                                <p class="text-rail-accent font-black text-[10px] uppercase tracking-widest mb-4">${t.route}</p>
                                <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl mb-6 grid grid-cols-2 gap-2 text-[11px] font-bold">
                                    ${t.fares.map(f=>`<div class="flex justify-between border-b border-gray-100 dark:border-gray-700 pb-1 text-left"><span class="text-gray-500">${f.class}</span><span class="text-rail-accent">${f.price}</span></div>`).join('')}
                                </div>
                                <div class="flex justify-between items-center font-black text-gray-900 dark:text-white"><span>Passenger Score (${t.reviewCount})</span><span class="stars text-2xl">${star}</span></div>
                            </div>
                            <div class="md:w-48 aspect-square bg-gray-100 dark:bg-gray-800 rounded-3xl overflow-hidden cursor-zoom-in group relative" onclick='openSliderModal(${JSON.stringify(fullSlidePaths)}, 0)'>
                                <img src="images/${t.slides[0]}" loading="lazy" class="w-full h-full object-cover transition duration-500 group-hover:scale-105">
                                ${t.slides.length > 1 ? `<div class="absolute bottom-2 right-2 bg-black/60 text-white text-[9px] px-2 py-1 rounded-lg font-black uppercase tracking-tighter">+${t.slides.length - 1}</div>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-900/40 p-8 border-t border-gray-100 dark:border-gray-800 flex-1">
                        <h4 class="font-black uppercase italic mb-6 text-gray-900 dark:text-white text-left">Recent Feedback</h4>
                        <div class="max-h-72 overflow-y-auto mb-8 pr-2 custom-scrollbar">${reviewsHtml}</div>
                        <form onsubmit="postReview(event, '${t.id}')" class="space-y-3">
                            <div class="grid grid-cols-2 gap-3"><input type="text" id="n-${t.id}" placeholder="Name" required class="bg-white dark:bg-gray-800 p-3 rounded-xl text-xs text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700"><select id="r-${t.id}" class="bg-white dark:bg-gray-800 p-3 rounded-xl text-xs text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700"><option value="5">5 Stars</option><option value="4">4 Stars</option><option value="3">3 Stars</option><option value="2">2 Stars</option><option value="1">1 Star</option></select></div>
                            <textarea id="c-${t.id}" placeholder="Your review..." required class="w-full bg-white dark:bg-gray-800 p-3 rounded-xl text-xs h-16 text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700"></textarea>
                            <button class="w-full bg-rail-accent text-white py-3 rounded-xl font-black uppercase text-[10px] shadow-lg">Submit Rating</button>
                        </form>
                    </div>
                </div>`;
            }).join('');
        }

        async function postReview(e, trainId) {
            e.preventDefault(); if (!user) return;
            const btn = e.target.querySelector('button');
            try {
                btn.disabled = true;
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('reviews').add({
                    trainId, name: document.getElementById(`n-${trainId}`).value, rating: parseInt(document.getElementById(`r-${trainId}`).value), comment: document.getElementById(`c-${trainId}`).value, timestamp: Date.now()
                });
                e.target.reset();
            } catch(err){ console.error(err); } finally { btn.disabled = false; }
        }

        async function fetchVideos(d, tok=null, app=false) {
            const container = document.getElementById('video-cards-container'); if (!container || !YT_KEY) return;
            const fd = d.charAt(0).toUpperCase() + d.slice(1);
            try {
                const res = await fetch(`https://www.googleapis.com/youtube/v3/search?key=${YT_KEY}&channelId=${YT_CHANNEL}&part=snippet,id&order=date&maxResults=6&type=video&videoDuration=${fd}${tok?'&pageToken='+tok:''}`);
                const data = await res.json(); yt_token = data.nextPageToken; 
                if (!app) container.innerHTML = '';
                if (data.items) data.items.forEach(v => {
                    container.innerHTML += `
                    <div class="bg-white dark:bg-gray-800 rounded-3xl overflow-hidden shadow-sm group cursor-pointer border border-gray-100 dark:border-gray-700 text-left" onclick="openVideo('${v.id.videoId}')">
                        <div class="aspect-video relative overflow-hidden bg-gray-200 dark:bg-gray-700">
                            <img src="https://img.youtube.com/vi/${v.id.videoId}/maxresdefault.jpg" alt="${v.snippet.title}" loading="lazy" class="w-full h-full object-cover transition duration-700 group-hover:scale-105">
                            <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition"><i class="fas fa-play text-white text-4xl"></i></div>
                        </div>
                        <div class="p-6 text-gray-900 dark:text-white"><h3 class="text-xs font-black uppercase line-clamp-2">${v.snippet.title}</h3></div>
                    </div>`;
                });
            } catch (e) {}
        }

        function startPollsListener() {
            if (!user) return;
            db.collection('artifacts').doc(appId).collection('public').doc('data').collection('polls').onSnapshot(snap => {
                const polls = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const container = document.getElementById('polls-container'); if (!container) return;
                container.innerHTML = polls.map(p => {
                    const total = p.options.reduce((a, b) => a + b.votes, 0);
                    return `<div class="bg-white dark:bg-rail-dark p-8 md:p-12 rounded-[3.5rem] border-2 border-rail-accent shadow-xl text-gray-900 dark:text-white text-left"><h3 class="text-2xl font-black italic uppercase mb-8">${escapeHTML(p.question)}</h3><div class="space-y-4">
                            ${p.options.map((o, i) => {
                                const per = total > 0 ? Math.round((o.votes / total) * 100) : 0;
                                return `<div class="relative group cursor-pointer" onclick="castVote('${p.id}', ${i})"><div class="flex justify-between font-black text-[10px] uppercase mb-1"><span>${escapeHTML(o.text)}</span><span>${per}%</span></div><div class="h-10 bg-gray-50 dark:bg-gray-800 rounded-xl overflow-hidden"><div class="poll-bar h-full bg-rail-accent" style="width: ${per}%"></div></div></div>`;
                            }).join('')}</div></div>`;
                }).join('');
            });
        }

        async function castVote(id, idx) {
            if (!user) return;
            const ref = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('polls').doc(id);
            await db.runTransaction(async t => {
                const doc = await t.get(ref); if (!doc.exists) return;
                const opts = doc.data().options; opts[idx].votes += 1;
                t.update(ref, { options: opts });
            });
        }

        function escapeHTML(s) { const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }
        
        function renderGallery() {
            const grid = document.getElementById('gallery-grid'); if (!grid) return;
            grid.innerHTML = galleryData.map(img => `
                <div class="group relative overflow-hidden rounded-[2.5rem] bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700 text-left">
                    <div class="w-full h-80 img-loading overflow-hidden">
                        <!-- FIXED: Using fetchpriority to load gallery first when active -->
                        <img src="${img.src}" alt="${img.title}" loading="lazy" class="w-full h-full object-cover transition duration-700 group-hover:scale-110 cursor-zoom-in" onclick="openSliderModal(['${img.src}'], 0)">
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent opacity-0 group-hover:opacity-100 transition flex flex-col justify-end p-8">
                        <h4 class="text-white text-xl font-black italic uppercase mb-4">${img.title}</h4>
                        <a href="${img.src}" download class="bg-rail-accent text-white text-center py-3 rounded-xl font-black text-[10px] uppercase">Download Wallpaper</a>
                    </div>
                </div>`).join('');
        }

        function openVideo(id) { document.getElementById('video-embed-container').innerHTML = `<iframe class="w-full h-full" src="https://www.youtube.com/embed/${id}?autoplay=1" frameborder="0" allowfullscreen></iframe>`; document.getElementById('video-modal').classList.remove('hidden'); document.getElementById('video-modal').classList.add('flex'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); document.body.style.overflow = 'auto'; if(id==='video-modal') document.getElementById('video-embed-container').innerHTML = ''; }
        
        function openSliderModal(images, index) {
            currentSliderImages = images;
            currentSliderIndex = index;
            updateSliderDisplay();
            
            const modal = document.getElementById('image-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';

            const controls = document.getElementById('slider-controls');
            if (images.length > 1) {
                controls.classList.remove('hidden');
                controls.classList.add('flex');
            } else {
                controls.classList.add('hidden');
            }
        }

        function updateSliderDisplay() {
            const img = document.getElementById('modal-image-content');
            const counter = document.getElementById('slider-counter');
            
            // Loading state for smoothness
            img.classList.add('opacity-40');
            img.src = currentSliderImages[currentSliderIndex];
            img.onload = () => img.classList.remove('opacity-40');
            
            counter.innerText = `${currentSliderIndex + 1} / ${currentSliderImages.length}`;
        }

        function nextSlide(e) {
            if(e) e.stopPropagation();
            currentSliderIndex = (currentSliderIndex + 1) % currentSliderImages.length;
            updateSliderDisplay();
        }

        function prevSlide(e) {
            if(e) e.stopPropagation();
            currentSliderIndex = (currentSliderIndex - 1 + currentSliderImages.length) % currentSliderImages.length;
            updateSliderDisplay();
        }

        window.addEventListener('DOMContentLoaded', () => {
            initFirebase(); 
            initTheme();
            
            document.getElementById('update-form').onsubmit = postUpdate;
            document.getElementById('admin-trigger').onclick = checkAdmin;
            document.getElementById('video-filter').onchange = (e) => { yt_duration = e.target.value; fetchVideos(yt_duration); };
            document.getElementById('load-more-btn').onclick = () => { if (yt_token) fetchVideos(yt_duration, yt_token, true); };

            document.addEventListener('keydown', (e) => {
                const modal = document.getElementById('image-modal');
                if (!modal.classList.contains('hidden')) {
                    if (e.key === 'ArrowRight') nextSlide();
                    if (e.key === 'ArrowLeft') prevSlide();
                    if (e.key === 'Escape') closeModal('image-modal');
                }
            });
        });

        window.onpopstate = handleRouting;
    </script>

    <!-- Modals -->
    <div id="video-modal" class="hidden fixed inset-0 z-[100] bg-black/95 items-center justify-center p-4" onclick="if(event.target.id === 'video-modal') closeModal('video-modal')">
        <div class="bg-black w-full max-w-6xl rounded-[2.5rem] overflow-hidden relative border border-white/10">
            <button onclick="closeModal('video-modal')" class="absolute top-6 right-6 text-white text-4xl">&times;</button>
            <div id="video-embed-container" class="aspect-video"></div>
        </div>
    </div>

    <!-- Image Slider Modal -->
    <div id="image-modal" class="hidden fixed inset-0 z-[100] bg-black/95 items-center justify-center p-4" onclick="if(event.target.id === 'image-modal') closeModal('image-modal')">
        <button onclick="closeModal('image-modal')" class="absolute top-6 right-6 text-white text-5xl font-thin z-[110]">&times;</button>
        
        <div id="slider-controls" class="hidden absolute inset-x-0 top-1/2 -translate-y-1/2 justify-between px-4 md:px-10 z-[110] pointer-events-none">
            <button onclick="prevSlide(event)" class="slider-btn pointer-events-auto w-12 h-12 md:w-16 md:h-16 flex items-center justify-center rounded-full text-white text-2xl shadow-2xl">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="nextSlide(event)" class="slider-btn pointer-events-auto w-12 h-12 md:w-16 md:h-16 flex items-center justify-center rounded-full text-white text-2xl shadow-2xl">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <div class="relative flex flex-col items-center">
            <img id="modal-image-content" src="" alt="Preview" class="max-w-full max-h-[85vh] object-contain rounded-3xl shadow-2xl transition-opacity duration-300">
            <div id="slider-counter" class="mt-6 bg-rail-accent text-white px-6 py-2 rounded-full font-black text-xs uppercase tracking-widest"></div>
        </div>
    </div>

    <div id="post-modal" class="hidden fixed inset-0 z-[100] bg-black/95 items-center justify-center p-4 overflow-y-auto" onclick="if(event.target.id === 'post-modal') closeModal('post-modal')">
        <div class="bg-white dark:bg-rail-dark w-full max-w-4xl rounded-[3rem] shadow-2xl relative border border-white/5 my-8">
            <button onclick="closeModal('post-modal')" class="absolute top-8 right-8 text-gray-400 text-5xl font-thin hover:text-rail-accent transition-colors">&times;</button>
            <div id="post-modal-body" class="p-10 md:p-20"></div>
        </div>
    </div>
</body>
</html>